# Архитектура CRM Gausdo

## Обзор
Система реализована как монолитное Laravel 12 приложение с административным интерфейсом на Filament v3. Веб-панель обслуживает пользователей ролей admin, purchaser и camp_manager через guard `web` и проверку доступа в `User::canAccessPanel()`.

## Основные компоненты
- **Веб-панель Filament** — управление заявками, шаблонами и пользователями, единая точка входа для всех ролей.
- **Модуль заявок на закупку** — формы, статусы, политика прав и архивация без физического удаления записей.
- **Модуль позиций заявки** — повторитель с расчётом сумм и тех. характеристиками.
- **Импорт Excel** — загрузка файла, предпросмотр и применение к списку позиций.
- **Шаблоны заявок** — CRUD для админов и закупщиков, отключён для camp_manager.
- **Дашборд и страница помощи** — приветствие пользователя, быстрые действия и markdown-инструкция из `storage/app/help.md`.

## Доступ и безопасность
- Аутентификация через стандартный веб-guard Laravel.
- `User::canAccessPanel()` блокирует доступ, если `is_active = false` или логика ролей возвращает `false`; это единственная причина 403 после логина.
- Политика `ProcurementRequestPolicy` ограничивает редактирование по ролям и статусам (camp_manager — только свои черновики).

## Потоки данных
1. Пользователь создаёт заявку в панели Filament; данные сохраняются в транзакционной БД.
2. Позиции заявки пересчитывают `line_total` на лету и суммируются в итог.
3. Действия изменения статусов запускаются через Filament actions, что гарантирует соблюдение правил переходов.
4. При импорте Excel файл загружается, валидируется, затем заполняет повторитель позиций перед сохранением.

## Хранилище данных
- **Локально**: SQLite.
- **Продакшен**: MySQL на Beget. Конфигурация кеша/сессий — файловая.

## Деплой и хостинг
Проект размещается в `/home/USER/camp-procurement/`, а `public/` вынесен в `/home/USER/public_html/`. В продакшене используются команды:
- `php artisan migrate --force`
- `php artisan storage:link`
- `php artisan optimize:clear`
- `php artisan config:cache`
- `php artisan route:cache`

## Наблюдаемость и эксплуатация
- Логи Laravel используются для мониторинга ошибок.
- При отсутствии CSS в панели проверить симлинк `storage` и правильность document root на Beget.
